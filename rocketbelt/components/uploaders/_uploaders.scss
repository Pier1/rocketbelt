.uploader:not(.uploader-expanded) {
  @extend %button-alternate;
}

.uploader.uploader-expanded {
  position: relative;
  display: flex;
  flex-direction: column;
  padding: padding(3);
  min-height: 8rem;
  width: 100%;
  border: 2px dashed color(brand, deepBlue);
  text-align: left;
  cursor: pointer;
  transition: border 300ms linear;
  justify-content: center;

  .scrim,
  .scrim_icon {
    position: absolute;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: -1;
    opacity: 0;
  }

  &.uploader-dragged-on {
    border: solid 2px color(secondary, darker);
    transition: border 300ms linear infinite;

    * {
      // Prevents dragover JS event from being fired nonstop.
      // See https://medium.com/@reiberdatschi/common-pitfalls-with-html5-drag-n-drop-api-9f011a09ee6c
      pointer-events: none;
    }

    .scrim {
      background-color: rgba(color(secondary, lighter), 1);
      opacity: 1;
      animation: pulseOpacity 750ms ease(in-out-quad) infinite;
      animation-direction: alternate;
    }

    .scrim_icon {
      $color-fill: color(secondary, darker);
      $icon-size: 8rem;

      background-color: rgba(color(secondary, lightest), 0.6);
      background-image:
        svg-url('\
          <svg width="276" height="226" viewBox="0 0 276 226" version="1" xmlns="http://www.w3.org/2000/svg">\
            <g fill="#{$color-fill}" fill-rule="evenodd">\
              <path d="M190 33l31-12 55 151-150 54-5-12-14 7-7-15 9-5 3 7 125-64-65-124-17 9-6-9 28-14 13 27zm-60 176l2 5 131-48-48-132-20 8 55 107-120 60z"/>\
              <path d="M78 129c-4 3-5 9-2 13l4 8 5 5-2 1c-2 1-5 0-7-2l-19-27a5 5 0 0 1 1-7l7-4c2-2 6-1 7 2l6 11zm82-18l-1-6-5-8c-3-5-8-6-13-4l-7-11c-1-3 0-6 2-7l7-4a5 5 0 0 1 7 2l14 31c1 2 0 5-2 6l-2 1zm-23-17l-55 32-6-11c-3-4-8-5-12-3L52 93c-2-3-1-6 1-8l62-36a6 6 0 0 1 8 3l10 20c-3 2-5 8-2 12l6 10zM0 80L138 0l80 139-138 80L0 80zm13 4l70 121 121-70-70-121L13 84zm71 5a3 3 0 1 0-3-6 3 3 0 0 0 3 6zm19-12a3 3 0 1 0-2-6 3 3 0 0 0 2 6zm8 17a3 3 0 1 0-2-6 3 3 0 0 0 2 6zm-17 10a3 3 0 1 0-2-6 3 3 0 0 0 2 6zm-12 27l59-34c3-2 7-1 8 2l5 9c2 3 1 6-2 8l-59 34c-3 2-7 1-8-2l-5-9c-2-3-1-6 2-8zm72-11l5-3 11 11a2 2 0 0 1-1 3c-1 1-3 1-4-1l-11-10zm-58 33l3 15c1 2 0 4-2 4a2 2 0 0 1-3-1l-3-15 5-3z"/>\
            </g>\
          </svg>\
        ')
      ;
      background-position: center center;
      background-size: $icon-size;
      background-repeat: no-repeat;
      content: '';
      opacity: 1;
      transition: opacity 300ms linear;
    }
  }

  input[type='file'] {
    display: none;
  }

  progress:not([value]),
  progress[value='0'] {
    display: none;
    visibility: hidden;
  }

  progress[value]:not([value='0']) {
    position: absolute;
    right: 0;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 10px;
    border: none;
    border-radius: 0;
    background-color: color(gray, plus3);
    color: color(secondary);
    appearance: none;

    &::-webkit-progress-bar, // sass-lint:disable-line no-vendor-prefixes
    &::-moz-progress-bar {   // sass-lint:disable-line no-vendor-prefixes
      background-color: color(gray, plus3);
    }

    &::-webkit-progress-value { // sass-lint:disable-line no-vendor-prefixes
      background-color: color(secondary);
      transition: width 500ms ease(out-quad);
    }
  }

  progress[value='100'] {
    &::after {
      $color-fill: color(success);
      $icon-size: 2rem;

      position: absolute;
      top: -1 * $icon-size;
      right: 4px;
      display: block;
      width: $icon-size;
      height: $icon-size;
      background-image: icon-as-data-uri(check, $color-fill);
      background-position: center center;
      background-size: $icon-size;
      background-repeat: no-repeat;
      content: '';
    }

    &[value]::-webkit-progress-value { // sass-lint:disable-line no-vendor-prefixes
      background-color: color(success);
      transition: background-color 200ms linear;
    }
  }

  .uploader_thumbs {
    &:not(:empty) {
      margin-top: 10px;
    }

    img {
      margin-right: 1rem;
      margin-bottom: 1rem;
      width: 150px;
      vertical-align: top;
    }
  }

  .uploader_text {
    margin: 0;
  }
}

@keyframes pulseOpacity {
  from {
    opacity: 0.8;
  }

  to {
    opacity: 0.4;
  }
}
