{"version":3,"sources":["components/dialogs/rocketbelt.dialogs.min.js"],"names":["global","addClass","elements","myClass","document","querySelectorAll","tagName","i","length","className","indexOf","removeClass","reg","RegExp","replace","dispatchEvent","el","eventName","emmiter","_CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","createEvent","initCustomEvent","prototype","window","Event","CustomEvent","getFocusableChildren","node","$$","join","filter","child","offsetWidth","offsetHeight","getClientRects","selector","context","Array","slice","call","trapTabKey","focusableChildren","focusedItemIndex","activeElement","shiftKey","focus","preventDefault","setFocusToFirstItem","focusedBeforeDialog","rbDialog","main","bindKeypress","that","shown","which","hide","maintainFocus","contains","target","show","removeAttribute","setAttribute","body","addEventListener","this","key","dataset","rbDialogHide","parentElement","removeEventListener","destroy","openers","forEach","opener","closers","closer","querySelector","id","concat","hasAttribute","JSON","parse","getAttribute","module","exports","define","amd","dialogs","len","dialogEl","obscures","rbDialogObscures","mainEl","getElementById","parentNode","insertBefore","nextSibling"],"mappings":"CAAC,SAAUA,GACT,YAEA,SAASC,GAASC,EAAUC,GAC1B,GAAKD,EAAL,CAEyB,gBAAf,GACRA,EAAWE,SAASC,iBAAiBH,GAI9BA,EAASI,UAChBJ,GAAUA,GAIZ,KAAK,GAAIK,GAAI,EAAGA,EAAIL,EAASM,OAAQD,KAC7B,IAAIL,EAASK,GAAGE,UAAU,KAAKC,QAAQ,IAAMP,EAAU,KAAO,IAClED,EAASK,GAAGE,WAAa,IAAMN,IAKrC,QAASQ,GAAYT,EAAUC,GAC7B,GAAKD,EAAL,CAEyB,gBAAf,GACRA,EAAWE,SAASC,iBAAiBH,GAI9BA,EAASI,UAChBJ,GAAUA,GAMZ,KAAK,GAHDU,GAAM,GAAIC,QAAO,QAAQV,EAAQ,QAAS,KAGrCI,EAAI,EAAGA,EAAIL,EAASM,OAAQD,IACnCL,EAASK,GAAGE,UAAYP,EAASK,GAAGE,UAAUK,QAAQF,EAAK,MAM/D,QAASG,GAAeC,EAAIC,EAAWC,GAGrC,QAASC,GAAcC,EAAOC,GAC5BA,EAASA,IAAYC,SAAS,EAAOC,YAAY,EAAOC,OAAQC,OAChE,IAAIC,GAAMtB,SAASuB,YAAY,cAE/B,OADAD,GAAIE,gBAAgBR,EAAOC,EAAOC,QAASD,EAAOE,WAAYF,EAAOG,QAC9DE,EAGTP,EAAaU,UAAYC,OAAOC,MAAMF,SAEtC,IAAIT,IAGFA,EADEU,OAAOE,aAA6C,kBAAvBF,QAAOE,YAC9B,GAAIF,QAAOE,YAAYf,GAAaO,OAAQN,IAE5C,GAAIC,GAAaF,GAAaK,SAAS,EAAOC,YAAY,EAAOC,OAAQN,MAG1EF,EAAGD,cAAcK,GAI5B,QAASa,GAAsBC,GAG7B,MAAOC,IAFkB,UAAW,aAAc,wBAAyB,yBAA0B,2BAA4B,yBAA0B,SAAU,SAAU,QAAS,oBAAqB,mCAEjLC,KAAK,KAAMF,GAAMG,OAAO,SAAUC,GAC5D,SAAUA,EAAMC,aAAeD,EAAME,cAAgBF,EAAMG,iBAAiBjC,UAKhF,QAAS2B,GAAIO,EAAUC,GACrB,MAAOC,OAAMf,UAAUgB,MAAMC,MAAMH,GAAWvC,UAAUC,iBAAiBqC,IAI3E,QAASK,GAAYb,EAAMd,GACzB,GAAI4B,GAAoBf,EAAqBC,GACzCe,EAAmBD,EAAkBtC,QAAQN,SAAS8C,cAEtD9B,GAAM+B,UAAiC,IAArBF,GACpBD,EAAkBA,EAAkBxC,OAAS,GAAG4C,QAChDhC,EAAMiC,kBACIjC,EAAM+B,UAAYF,IAAqBD,EAAkBxC,OAAS,IAC5EwC,EAAkB,GAAGI,QACrBhC,EAAMiC,kBAKV,QAASC,GAAqBpB,GAC5B,GAAIc,GAAoBf,EAAqBC,EACzCc,GAAkBxC,QAAQwC,EAAkB,GAAGI,QAGrD,GAAIG,GAOAC,EAAW,SAAUtB,EAAMuB,GAuB7B,QAASC,GAActC,GACjBuC,EAAKC,OAAyB,KAAhBxC,EAAMyC,QACtBzC,EAAMiC,iBACNS,EAAK1C,EAAMyC,QAGTF,EAAKC,OAAyB,IAAhBxC,EAAMyC,OACtBd,EAAWb,EAAMd,GAIrB,QAAS2C,GAAe3C,GAClBuC,EAAKC,QAAU1B,EAAK8B,SAAS5C,EAAM6C,SACrCX,EAAoBpB,GAIxB,QAASgC,KACHP,EAAKC,QAETD,EAAKC,OAAQ,EAEb3D,EAASwD,EAAM,kBAEfvB,EAAKiC,gBAAgB,eACrBV,EAAKW,aAAa,cAAe,QACjCb,EAAsBnD,SAAS8C,cAC/BI,EAAoBpB,GACpB9B,SAASiE,KAAKC,iBAAiB,QAASP,GAAe,GACvD3D,SAASkE,iBAAiB,UAAWZ,GACrC3C,EAAcmB,EAAM,cAAeqC,OAGrC,QAAST,GAAMU,GACRb,EAAKC,QAEgCnC,SAAtCL,MAAM6C,OAAOQ,QAAQC,cAC+BjD,SAApDL,MAAM6C,OAAOU,cAAcF,QAAQC,cAC+BjD,SAAlEL,MAAM6C,OAAOU,cAAcA,cAAcF,QAAQC,cACzC,KAARF,IACFb,EAAKC,OAAQ,EAEbjD,EAAY8C,EAAM,kBAElBvB,EAAKkC,aAAa,cAAe,QACjCX,EAAKU,gBAAgB,eACrBZ,GAAuBA,EAAoBH,QAC3ChD,SAASiE,KAAKO,oBAAoB,QAASb,GAAe,GAC1D3D,SAASwE,oBAAoB,UAAWlB,GACxC3C,EAAcmB,EAAM,cAAeqC,QAIvC,QAASM,KACPf,IAEAgB,EAAQC,QAAQ,SAAUC,GACxBA,EAAOJ,oBAAoB,QAASV,KAGtCe,EAAQF,QAAQ,SAAUG,GACxBA,EAAON,oBAAoB,QAASd,KAnFxCL,EAAOA,GAAQrD,SAAS+E,cAAc,QACtC,IAAIxB,GAAOY,KACPO,EAAU3C,EAAG,yBAA2BD,EAAKkD,GAAK,MAClDH,EAAU9C,EAAG,wBAAyBD,GACvCmD,OAAOlD,EAAG,yBAA2BD,EAAKkD,GAAK,MAE9ClD,GAAKoD,aAAa,iBACpBf,KAAKX,OAAS2B,KAAKC,MAAMtD,EAAKuD,aAAa,iBAG7ClB,KAAKL,KAAOA,EACZK,KAAKT,KAAOA,EACZS,KAAKM,QAAUA,EAEfC,EAAQC,QAAQ,SAAUC,GACxBA,EAAOV,iBAAiB,QAASJ,KAGnCe,EAAQF,QAAQ,SAAUG,GACxBA,EAAOZ,iBAAiB,QAASR,KAqEf,oBAAX4B,SAAoD,SAAnBA,OAAOC,QACjDD,OAAOC,QAAUnC,EACU,kBAAXoC,SAAyBA,OAAOC,IAChDD,OAAO,cAAgB,WACrB,MAAOpC,KAEkB,gBAAXxD,KAChBA,EAAOwD,SAAWA,IAEpBe,MAED,WACCnE,SAASkE,iBAAiB,mBAAoB,WAI5C,IAAK,GAHDwB,GAAU1F,SAASC,iBAAiB,WAEpC0F,EAAMD,EAAQtF,OACTD,EAAI,EAAGA,EAAIwF,EAAKxF,IAAK,CAC5B,GAAIyF,GAAWF,EAAQvF,GACnB0F,EAAWD,EAASvB,QAAQyB,iBAC5BC,EAAS/F,SAASgG,eAAeH,EAErCE,GAAOE,WAAWC,aAAaN,EAAUG,EAAOI,YAEnC,IAAIzE,QAAO0B,SAASwC,EAAUG","file":"rocketbelt.dialogs.min.js","sourcesContent":["(function (global) {\n  'use strict';\n\n  function addClass(elements, myClass) {\n    if (!elements) { return; }\n\n    if (typeof(elements) === 'string') {\n      elements = document.querySelectorAll(elements);\n    }\n\n    // If match is a single DOM element, make it an array to simplify behavior\n    else if (elements.tagName) {\n      elements=[elements];\n    }\n\n    // Add class to all chosen elements\n    for (var i = 0; i < elements.length; i++) {\n      if ( (' '+elements[i].className+' ').indexOf(' ' + myClass + ' ') < 0 ) {\n        elements[i].className += ' ' + myClass;\n      }\n    }\n  }\n\n  function removeClass(elements, myClass) {\n    if (!elements) { return; }\n\n    if (typeof(elements) === 'string') {\n      elements = document.querySelectorAll(elements);\n    }\n\n    // If match is a single DOM element, make it an array to simplify behavior\n    else if (elements.tagName) {\n      elements=[elements];\n    }\n    // Create pattern to find class name\n    var reg = new RegExp('(^| )'+myClass+'($| )', 'g');\n\n    // Remove class from all chosen elements\n    for (var i = 0; i < elements.length; i++) {\n      elements[i].className = elements[i].className.replace(reg, ' ');\n    }\n  }\n\n  // Helper function for dispatching cross browser dispatch events\n  // from http://youmightnotneedjquery.com/#trigger_custom\n  function dispatchEvent (el, eventName, emmiter) {\n    // IE < Edge Polyfill\n    // from https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent\n    function _CustomEvent (event, params) {\n      params = params || { bubbles: false, cancelable: false, detail: undefined };\n      var evt = document.createEvent('CustomEvent');\n      evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return evt;\n    }\n\n    _CustomEvent.prototype = window.Event.prototype;\n\n    var event;\n\n    if (window.CustomEvent && typeof window.CustomEvent === 'function') {\n      event = new window.CustomEvent(eventName, { detail: emmiter });\n    } else {\n      event = new _CustomEvent(eventName, { bubbles: false, cancelable: false, detail: emmiter });\n    }\n\n    event && el.dispatchEvent(event);\n  }\n\n  // Helper function to get all focusable children from a node\n  function getFocusableChildren (node) {\n    var focusableElements = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])'];\n\n    return $$(focusableElements.join(','), node).filter(function (child) {\n      return !!(child.offsetWidth || child.offsetHeight || child.getClientRects().length);\n    });\n  }\n\n  // Helper function to get all nodes in context matching selector as an array\n  function $$ (selector, context) {\n    return Array.prototype.slice.call((context || document).querySelectorAll(selector));\n  }\n\n  // Helper function trapping the tab key inside a node\n  function trapTabKey (node, event) {\n    var focusableChildren = getFocusableChildren(node);\n    var focusedItemIndex = focusableChildren.indexOf(document.activeElement);\n\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableChildren[focusableChildren.length - 1].focus();\n      event.preventDefault();\n    } else if (!event.shiftKey && focusedItemIndex === focusableChildren.length - 1) {\n      focusableChildren[0].focus();\n      event.preventDefault();\n    }\n  }\n\n  // Helper function to focus first focusable item in node\n  function setFocusToFirstItem (node) {\n    var focusableChildren = getFocusableChildren(node);\n    if (focusableChildren.length) focusableChildren[0].focus();\n  }\n\n  var focusedBeforeDialog;\n\n  /**\n   * rbDialog constructor\n   * @param {Node} node - Dialog element\n   * @param {Node} main - Main element of the page\n   */\n  var rbDialog = function (node, main) {\n    main = main || document.querySelector('#main');\n    var that = this;\n    var openers = $$('[data-rb-dialog-show=\"' + node.id + '\"]');\n    var closers = $$('[data-rb-dialog-hide]', node)\n      .concat($$('[data-rb-dialog-hide=\"' + node.id + '\"]'));\n\n    if (node.hasAttribute('aria-hidden')) {\n      this.shown = !JSON.parse(node.getAttribute('aria-hidden'));\n    }\n\n    this.show = show;\n    this.hide = hide;\n    this.destroy = destroy;\n\n    openers.forEach(function (opener) {\n      opener.addEventListener('click', show);\n    });\n\n    closers.forEach(function (closer) {\n      closer.addEventListener('click', hide);\n    });\n\n    function bindKeypress (event) {\n      if (that.shown && event.which === 27) {\n        event.preventDefault();\n        hide(event.which);\n      }\n\n      if (that.shown && event.which === 9) {\n        trapTabKey(node, event);\n      }\n    }\n\n    function maintainFocus (event) {\n      if (that.shown && !node.contains(event.target)) {\n        setFocusToFirstItem(node);\n      }\n    }\n\n    function show () {\n      if (that.shown) return;\n\n      that.shown = true;\n\n      addClass(main, 'is-dialog-open');\n\n      node.removeAttribute('aria-hidden');\n      main.setAttribute('aria-hidden', 'true');\n      focusedBeforeDialog = document.activeElement;\n      setFocusToFirstItem(node);\n      document.body.addEventListener('focus', maintainFocus, true);\n      document.addEventListener('keydown', bindKeypress);\n      dispatchEvent(node, 'dialog:show', this);\n    }\n\n    function hide (key) {\n      if (!that.shown) return;\n\n      if (event.target.dataset.rbDialogHide !== undefined ||\n          event.target.parentElement.dataset.rbDialogHide !== undefined ||\n          event.target.parentElement.parentElement.dataset.rbDialogHide !== undefined ||\n          key === 27) {\n        that.shown = false;\n\n        removeClass(main, 'is-dialog-open');\n\n        node.setAttribute('aria-hidden', 'true');\n        main.removeAttribute('aria-hidden');\n        focusedBeforeDialog && focusedBeforeDialog.focus();\n        document.body.removeEventListener('focus', maintainFocus, true);\n        document.removeEventListener('keydown', bindKeypress);\n        dispatchEvent(node, 'dialog:hide', this);\n      }\n    }\n\n    function destroy () {\n      hide();\n\n      openers.forEach(function (opener) {\n        opener.removeEventListener('click', show);\n      });\n\n      closers.forEach(function (closer) {\n        closer.removeEventListener('click', hide);\n      });\n    }\n  };\n\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = rbDialog;\n  } else if (typeof define === 'function' && define.amd) {\n    define('rbDialog', [], function () {\n      return rbDialog;\n    });\n  } else if (typeof global === 'object') {\n    global.rbDialog = rbDialog;\n  }\n}(this));\n\n(function () {\n  document.addEventListener('DOMContentLoaded', function () {\n    var dialogs = document.querySelectorAll('.dialog');\n\n    var len = dialogs.length;\n    for (var i = 0; i < len; i++) {\n      var dialogEl = dialogs[i];\n      var obscures = dialogEl.dataset.rbDialogObscures;\n      var mainEl = document.getElementById(obscures);\n\n      mainEl.parentNode.insertBefore(dialogEl, mainEl.nextSibling);\n\n      var dialog = new window.rbDialog(dialogEl, mainEl);\n    }\n  });\n}());\n"],"sourceRoot":"../.."}