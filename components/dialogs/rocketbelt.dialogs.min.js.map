{"version":3,"sources":["components/dialogs/rocketbelt.dialogs.min.js"],"names":["global","addClass","elements","myClass","document","querySelectorAll","tagName","i","length","className","indexOf","removeClass","reg","RegExp","replace","dispatchEvent","el","eventName","emmiter","_CustomEvent","event","params","bubbles","cancelable","detail","undefined","evt","createEvent","initCustomEvent","prototype","window","Event","CustomEvent","getFocusableChildren","node","focusableElements","$$","join","filter","child","offsetWidth","offsetHeight","getClientRects","selector","context","Array","slice","call","trapTabKey","focusableChildren","focusedItemIndex","activeElement","shiftKey","focus","preventDefault","setFocusToFirstItem","focusedBeforeDialog","rbDialog","main","bindKeypress","that","shown","which","hide","maintainFocus","contains","target","show","removeAttribute","setAttribute","body","addEventListener","this","removeEventListener","destroy","openers","forEach","opener","closers","closer","querySelector","id","concat","hasAttribute","JSON","parse","getAttribute","module","exports","define","amd","dialogs","len","dialogEl","obscures","dataset","rbDialogObscures","mainEl","getElementById","parentNode","insertBefore","nextSibling"],"mappings":"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","file":"rocketbelt.dialogs.min.js","sourcesContent":["(function (global) {\n  'use strict';\n\n  function addClass(elements, myClass) {\n    if (!elements) { return; }\n\n    if (typeof(elements) === 'string') {\n      elements = document.querySelectorAll(elements);\n    }\n\n    // If match is a single DOM element, make it an array to simplify behavior\n    else if (elements.tagName) {\n      elements=[elements];\n    }\n\n    // Add class to all chosen elements\n    for (var i = 0; i < elements.length; i++) {\n      if ( (' '+elements[i].className+' ').indexOf(' ' + myClass + ' ') < 0 ) {\n        elements[i].className += ' ' + myClass;\n      }\n    }\n  }\n\n  function removeClass(elements, myClass) {\n    if (!elements) { return; }\n\n    if (typeof(elements) === 'string') {\n      elements = document.querySelectorAll(elements);\n    }\n\n    // If match is a single DOM element, make it an array to simplify behavior\n    else if (elements.tagName) {\n      elements=[elements];\n    }\n    // Create pattern to find class name\n    var reg = new RegExp('(^| )'+myClass+'($| )', 'g');\n\n    // Remove class from all chosen elements\n    for (var i = 0; i < elements.length; i++) {\n      elements[i].className = elements[i].className.replace(reg, ' ');\n    }\n  }\n\n  // Helper function for dispatching cross browser dispatch events\n  // from http://youmightnotneedjquery.com/#trigger_custom\n  function dispatchEvent (el, eventName, emmiter) {\n    // IE < Edge Polyfill\n    // from https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent\n    function _CustomEvent (event, params) {\n      params = params || { bubbles: false, cancelable: false, detail: undefined };\n      var evt = document.createEvent('CustomEvent');\n      evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n      return evt;\n    }\n\n    _CustomEvent.prototype = window.Event.prototype;\n\n    var event;\n\n    if (window.CustomEvent && typeof window.CustomEvent === 'function') {\n      event = new window.CustomEvent(eventName, { detail: emmiter });\n    } else {\n      event = new _CustomEvent(eventName, { bubbles: false, cancelable: false, detail: emmiter });\n    }\n\n    event && el.dispatchEvent(event);\n  }\n\n  // Helper function to get all focusable children from a node\n  function getFocusableChildren (node) {\n    var focusableElements = ['a[href]', 'area[href]', 'input:not([disabled])', 'select:not([disabled])', 'textarea:not([disabled])', 'button:not([disabled])', 'iframe', 'object', 'embed', '[contenteditable]', '[tabindex]:not([tabindex^=\"-\"])'];\n\n    return $$(focusableElements.join(','), node).filter(function (child) {\n      return !!(child.offsetWidth || child.offsetHeight || child.getClientRects().length);\n    });\n  }\n\n  // Helper function to get all nodes in context matching selector as an array\n  function $$ (selector, context) {\n    return Array.prototype.slice.call((context || document).querySelectorAll(selector));\n  }\n\n  // Helper function trapping the tab key inside a node\n  function trapTabKey (node, event) {\n    var focusableChildren = getFocusableChildren(node);\n    var focusedItemIndex = focusableChildren.indexOf(document.activeElement);\n\n    if (event.shiftKey && focusedItemIndex === 0) {\n      focusableChildren[focusableChildren.length - 1].focus();\n      event.preventDefault();\n    } else if (!event.shiftKey && focusedItemIndex === focusableChildren.length - 1) {\n      focusableChildren[0].focus();\n      event.preventDefault();\n    }\n  }\n\n  // Helper function to focus first focusable item in node\n  function setFocusToFirstItem (node) {\n    var focusableChildren = getFocusableChildren(node);\n    if (focusableChildren.length) focusableChildren[0].focus();\n  }\n\n  var focusedBeforeDialog;\n\n  /**\n   * rbDialog constructor\n   * @param {Node} node - Dialog element\n   * @param {Node} main - Main element of the page\n   */\n  var rbDialog = function (node, main) {\n    main = main || document.querySelector('#main');\n    var that = this;\n    var openers = $$('[data-rb-dialog-show=\"' + node.id + '\"]');\n    var closers = $$('[data-rb-dialog-hide]', node)\n      .concat($$('[data-rb-dialog-hide=\"' + node.id + '\"]'));\n\n    if (node.hasAttribute('aria-hidden')) {\n      this.shown = !JSON.parse(node.getAttribute('aria-hidden'));\n    }\n\n    this.show = show;\n    this.hide = hide;\n    this.destroy = destroy;\n\n    openers.forEach(function (opener) {\n      opener.addEventListener('click', show);\n    });\n\n    closers.forEach(function (closer) {\n      closer.addEventListener('click', hide);\n    });\n\n    function bindKeypress (event) {\n      if (that.shown && event.which === 27) {\n        event.preventDefault();\n        hide();\n      }\n\n      if (that.shown && event.which === 9) {\n        trapTabKey(node, event);\n      }\n    }\n\n    function maintainFocus (event) {\n      if (that.shown && !node.contains(event.target)) {\n        setFocusToFirstItem(node);\n      }\n    }\n\n    function show () {\n      if (that.shown) return;\n\n      that.shown = true;\n\n      addClass(main, 'is-dialog-open');\n\n      node.removeAttribute('aria-hidden');\n      main.setAttribute('aria-hidden', 'true');\n      focusedBeforeDialog = document.activeElement;\n      setFocusToFirstItem(node);\n      document.body.addEventListener('focus', maintainFocus, true);\n      document.addEventListener('keydown', bindKeypress);\n      dispatchEvent(node, 'dialog:show', this);\n    }\n\n    function hide () {\n      if (!that.shown) return;\n\n      that.shown = false;\n\n      removeClass(main, 'is-dialog-open');\n\n      node.setAttribute('aria-hidden', 'true');\n      main.removeAttribute('aria-hidden');\n      focusedBeforeDialog && focusedBeforeDialog.focus();\n      document.body.removeEventListener('focus', maintainFocus, true);\n      document.removeEventListener('keydown', bindKeypress);\n      dispatchEvent(node, 'dialog:hide', this);\n    }\n\n    function destroy () {\n      hide();\n\n      openers.forEach(function (opener) {\n        opener.removeEventListener('click', show);\n      });\n\n      closers.forEach(function (closer) {\n        closer.removeEventListener('click', hide);\n      });\n    }\n  };\n\n  if (typeof module !== 'undefined' && typeof module.exports !== 'undefined') {\n    module.exports = rbDialog;\n  } else if (typeof define === 'function' && define.amd) {\n    define('rbDialog', [], function () {\n      return rbDialog;\n    });\n  } else if (typeof global === 'object') {\n    global.rbDialog = rbDialog;\n  }\n}(this));\n\n(function () {\n  document.addEventListener('DOMContentLoaded', function () {\n    var dialogs = document.querySelectorAll('.dialog');\n\n    var len = dialogs.length;\n    for (var i = 0; i < len; i++) {\n      var dialogEl = dialogs[i];\n      var obscures = dialogEl.dataset.rbDialogObscures;\n      var mainEl = document.getElementById(obscures);\n\n      mainEl.parentNode.insertBefore(dialogEl, mainEl.nextSibling);\n\n      var dialog = new window.rbDialog(dialogEl, mainEl);\n    }\n\n    // To manually control the dialog:\n    // dialog.show()\n    // dialog.hide()\n  });\n}());\n"],"sourceRoot":"../.."}