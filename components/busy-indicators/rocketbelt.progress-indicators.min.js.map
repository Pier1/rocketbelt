{"version":3,"sources":["components/busy-indicators/rocketbelt.progress-indicators.min.js"],"names":["rb","document","mutations","mutationsLen","onClassMutation","length","k","mutation","setIndicators","oldValue","el","classList","contains","busyable","querySelectorAll","parentNode","getElementsByClassName","markup","segmentClass","segment","messageAttr","message","repeat","delay","dataset","rbIsBusyMessageAfterSeconds","setTimeout","loader","querySelector","add","fragment","a11yAttrs","overlay","nodeName","elType","insertAdjacentHTML","requestAnimationFrame","removeChild","observeComponents","busyableEl","observer","MutationObserver","i","busyableLen","observe","subtree","attributes","attributeOldValue","attributeFilter","progressIndicators","forEach","onDocumentReady","window"],"mappings":"AAAA,cACA,SAAEA,EAAIC,GAAL,SAACD,EAAiBE,GAIf,IAHF,IAAAC,EAASC,GAA2BF,EAAAG,OAAAH,EAAAG,OAAA,EAGzBC,EAAI,EAAGA,EAAIH,EAAcG,IAAK,CAAvC,IAAKC,EAAWD,EAAIH,GAKlBK,EAJMD,EAAWL,OACNK,EAAXE,WAOJ,SAASD,EAAcE,EAAID,GAA3B,GAAAA,GAASD,EAAkBC,MAA3B,iBACMC,EAAED,YAGJC,EAAAC,UAAAC,SAAA,WAqDK,CAWP,IAAIC,EAAWZ,EAAAA,iBAASa,oBAAxB,GAEID,IAASR,EAAbU,WAA2BJ,UAAAC,SAAA,YACzBC,EAAAA,WAAoBC,YAAAA,QAjElB,GAAA,IAAAJ,EAAAM,uBAAA,mBAAAX,OAAA,CACA,IAAIY,EAAS,GAGX,GAAAP,EAAMQ,UAAAA,SAAe,oBAArB,CACA,IAAMC,EAAAA,0CAGAC,EAAAA,EAAcC,QAAAA,gBAEpBJ,EAAAA,4BAFoBI,EAAAA,6BAAuCA,EAAvC,IAAoD,IAExE,oFAEgBF,EAAQG,OAAO,GAF/B,yDAWG,IAAAC,EAAAb,EAAAc,QAAAC,4BAEDC,IACEH,IACAA,EAAII,GAGLD,WAAU,WACZ,IAAAC,EAAAjB,EAAAkB,cAAA,gBACID,GAAAA,EAAAhB,WACLM,EAASN,UAAAkB,IAAA,0BAHI,IAARN,SASPN,EAAMa,6CAAAR,OACkCS,GAJxC,IAWQC,EAAaJ,OAAbI,EAAUtB,UAAhB,OAAiCA,EAAAuB,SAAjC,KAAA,MACID,EAAAA,IACFA,EADEA,kHAEHf,EAFGe,eAFNE,EAEMF,IAnDVtB,EAwDOyB,mBAAA,YAAAL,GAELM,sBAAmBtB,WARf,IAAMkB,EAAUtB,EAAGkB,cAAc,oBAUjCI,GAAYA,EAAQjB,WACtBiB,EAAQjB,UAAWsB,IAAAA,6BAcvB,SAAKC,IACH,IAAAzB,EAAM0B,EAAa1B,iBAAnB,gBAEA,IAAAA,EAAAR,SACAQ,EAAM2B,EAAeC,iBAAiB,SAMzC,IALGD,IAAAA,EACED,EADFlC,OAKHqC,EAAA,EAAAA,EAAAC,EAAAD,IAAA,CATG,IAAMH,EAAa1B,EAAS6B,GAaT5B,IAAAA,iBAAiB,SAAAZ,GAAtCE,EAAAF,KACA0C,QACEpC,EADF,CAAAqC,SAAA,EAAAC,YAAA,EAAAC,mBAAA,EAAAC,gBAAA,CAAA,YAOFhD,EAAGiD,gBAAAA,WARWhD,EAASa,iBAAiB,YAClCoC,QAAQ,SAACxC,GACXF,EAAcE,OAGlBV,EAAGmD,gBAAgBb,GACnBtC,EAAGiD,mBAAqBjD,EAAGiD,oBAAsB,GACjDjD,EAAGiD,mBAAmBzC,cAAgBA,EACtCR,EAAGiD,mBAAmBX,kBAAoBA,EA/G5C,CAgHGc,OAAOpD,GAAIC","file":"rocketbelt.progress-indicators.min.js","sourcesContent":["'use strict';\n((rb, document) => {\n  function onClassMutation(mutations) {\n    const mutationsLen = mutations && mutations.length ? mutations.length : 0;\n\n    for (let k = 0; k < mutationsLen; k++) {\n      const mutation = mutations[k];\n      const el = mutation.target;\n      const oldValue = mutation.oldValue;\n\n      setIndicators(el, oldValue);\n    }\n  }\n\n  function setIndicators(el, oldValue) {\n    if ((!oldValue || !oldValue.match(/\\bis-busy\\b/)) &&\n        el.classList &&\n        el.classList.contains('is-busy')) {\n      // If \"is-busy\" was added, do the decoratin'\n      if (el.getElementsByClassName('is-busy_overlay').length === 0) {\n        // Only add overlay if one doesn't already exist\n        let markup = '';\n\n        if (el.classList.contains('is-busyable-page')) {\n          const segmentClass = 'flip-loader_segment';\n          const segment = `<div class=\"${segmentClass}\"></div>`;\n\n          const message = el.dataset.rbIsBusyMessage;\n          const messageAttr = message ? ` data-rb-is-busy-message=\"${message}\"` : '';\n\n          markup = `<div class=\"flip-loader\"${messageAttr}>\\\n                      <div class=\"flip-loader_segments\">\\\n                        ${segment.repeat(5)}\\\n                      </div>\\\n                    </div>`;\n\n          let delay = el.dataset.rbIsBusyMessageAfterSeconds;\n\n          if (message) {\n            if (!delay) {\n              delay = 0;\n            }\n\n            setTimeout(() => {\n              const loader = el.querySelector('.flip-loader');\n              if (loader && loader.classList) {\n                loader.classList.add('is-busy_message-shown');\n              }\n            }, delay * 1000);\n          }\n        } else {\n          markup = '<div class=\"dot\" aria-hidden=\"true\"></div>'.repeat(5);\n        }\n\n        const a11yAttrs =\n          'aria-label=\"Loading.\" role=\"alert\" aria-live=\"assertive\" aria-busy=\"true\"';\n        const elType = el.nodeName === 'UL' || el.nodeName === 'OL' ? 'li' : 'div';\n        const fragment =\n          `<${elType} class=\"is-busy_overlay\" ${a11yAttrs}>\\\n            ${markup}\\\n          </${elType}>`;\n\n        el.insertAdjacentHTML('beforeend', fragment);\n\n        requestAnimationFrame(() => {\n          const overlay = el.querySelector('.is-busy_overlay');\n          if (overlay  && overlay.classList) {\n            overlay.classList.add('is-busy_overlay-opaque');\n          }\n        });\n      }\n    } else {\n      // If \"is-busy\" was removed\n      const overlay = el.querySelectorAll('.is-busy_overlay')[0];\n\n      if (overlay && !overlay.parentNode.classList.contains('is-busy')) {\n        overlay.parentNode.removeChild(overlay);\n      }\n    }\n  }\n\n  function observeComponents() {\n    let busyable = document.querySelectorAll('.is-busyable');\n\n    if (busyable.length === 0) {\n      busyable = document.querySelectorAll('body');\n    }\n\n    const busyableLen = busyable.length;\n\n    for (let i = 0; i < busyableLen; i++) {\n      const busyableEl = busyable[i];\n\n      // Set an observer to listen for .invalid.\n      const observer = new MutationObserver((mutations) => { onClassMutation(mutations); });\n      observer.observe(\n        busyableEl,\n        { subtree: true, attributes: true, attributeOldValue: true, attributeFilter: ['class'] }\n      );\n    }\n  }\n\n  rb.onDocumentReady(() => {\n    // Set busy indicators for any elements that have `.is-busy` on page load.\n    const els = document.querySelectorAll('.is-busy');\n    els.forEach((el) => {\n      setIndicators(el);\n    });\n  });\n  rb.onDocumentReady(observeComponents);\n  rb.progressIndicators = rb.progressIndicators || {};\n  rb.progressIndicators.setIndicators = setIndicators;\n  rb.progressIndicators.observeComponents = observeComponents;\n})(window.rb, document);\n"],"sourceRoot":"../.."}