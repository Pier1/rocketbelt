{"version":3,"sources":["components/forms/rocketbelt.forms.min.js"],"names":["rb","document","aria","decorateInputs","formEls","querySelectorAll","formElsLen","length","_loop","el","i","classList","add","onClassMutation","mutations","mutationsLen","k","mutation","target","querySelector","describedByErrorId","describedByIds","oldValue","contains","setAttribute","invalid","DESCRIBED_BY_ERROR_ID_ATTR","getAttribute","message","role","push","join","removeAttribute","live","splice","describedby","observe","observer","subtree","attributes","attributeOldValue","messages","parentNode","msgLen","hasAttribute","j","thisMsg","id","getShortId","trim","formsAndGroups","_loop2","addEventListener","checkValidity","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","value","err","return","forms","window"],"mappings":"AAAA,cACA,SAAEA,EAAIC,GAAL,IAAAC,EAAKD,EAAAA,KACEC,EAAN,6BAuDA,SAASC,IAOL,IAPJ,IAAAC,EAASD,EAAiBE,iBACxB,qFAGMC,EAAaF,EAAQG,OAJHC,EAAA,SAOhBC,GAAN,IAAMA,EAAKL,EAAQM,GAOjBD,EAAAA,iBAAiB,UAAjB,WADFA,EAEGE,UAFHC,IAAA,aAEG,GAGkDC,IAAgBC,iBAAhB,SAAAA,IAtEzD,SAAyBA,GAGvB,IAHF,IAAAC,EAASF,EAAgBC,OAGdE,EAAI,EAAGA,EAAID,EAAcC,IAAK,CAAvC,IAAKC,EAAWD,EAAID,GACZE,EAAAA,EAAWH,OACXL,EAAKQ,EAASC,WAApBC,cAAA,uBAGIC,EAAqB,GAArBA,EAAAA,GACAC,GAAAA,EAGsB,YAAtBJ,EAASK,UAA0BL,EAASC,OAAOP,UAAUY,SAAS,YACxEd,EAAAe,aAAAtB,EAAAuB,QAAA,QACAhB,EAAqBgB,EAAAA,aAArBC,GAEAL,GADAD,EAAAA,EAAAA,aAAwBO,EAAaD,aAAAA,MAAAA,MACpBjB,QAAGkB,GAGhBC,IAAJA,EAAIA,aAAS1B,EAAA2B,KAAA,SACXD,EAAQJ,aAAatB,EAAK2B,KAAM,WAIhC,IAAAnB,IACAW,EAAcS,KAAAV,GACZC,EAAAA,aAAeS,EAAKV,YAAAA,EAApBW,KAAA,SAGH,YAAAd,EAAAK,UAAAb,EAAAE,UAAAY,SAAA,aAEDd,EAAAe,aAAAtB,EAAAuB,QAAA,SACAhB,EAAqBgB,EAAAA,aAArBC,GAEAL,GADAD,EAAAA,EAAAA,aAAwBO,EAAaD,aAAAA,MAAAA,MACpBjB,QAAGkB,GAGhBC,IAAJA,EAAIA,gBAAS,QACXA,EAAQI,gBAAgB9B,EAAA+B,OAIxB,EAAAvB,IACAW,EAAYa,OAAAxB,EAAA,GACVW,EAAAA,aAAea,EAAfC,YAAAd,EAAAU,KAAA,UA0B+ClB,CAAAC,KAArDsB,QAAA3B,EAAA,CACA4B,SAASD,EACPE,YAAS,EACTC,mBAFmB,EAGnBC,gBAAAA,CAAAA,WAIF,IAAMC,EAAWhC,EAAGiC,WAAWrC,iBAAiB,qCAA1CoC,EAAWhC,EAAGiC,OAGpB,GAAa,EAATC,EAAY,CAAhB,IAAIA,EAAY,GAGVlC,EAAGmC,aAAa1C,EAAKiC,eAAzBd,EAAoBnB,EAAKiC,aAAzBjC,EAAuCiC,aAAvC,KAIA,IAAK,IAAIU,EAAI,EAAGA,EAAIF,EAAQE,IAAK,CAAjC,IAAKC,EAAWD,EAAhBA,GACQC,EAAAA,EAAUL,GAAAK,EAAhBC,GAAMD,WAAN9C,EAAAgD,aACA3B,GAAW0B,EAAX,IAGID,EAAQnC,UAAUY,SAAS,uBAA/Bd,EAAIqC,aAAQnC,EAAmBoC,GAI/BD,EAAAC,KACAD,EAAKA,GAALC,GAKGtC,EAAGmC,aAAa1C,EAAKiC,cAA1B1B,EAAKA,aAAGmC,EAAa1C,YAAKiC,EAAcc,UA5CpCxC,EAAKL,EAAAA,EAAAE,EAAXI,IAAAF,EAAMC,GAkDR,IAAMyC,EAnDNjD,EAASS,iBAAWJ,uDANI6C,EAAA,SAMa1C,GAiDpCA,EAAA2C,iBAAA,OAAA,WAMG3C,EAAG4C,mBA7DiBC,GAAA,EAAAC,GAAA,EAAAC,OAAAC,EAAA,IAMa,IAAA,IAAAC,EAAAC,EAAAT,EAAAU,OAAAC,cAAAP,GAAAI,EAAAC,EAAAG,QAAAC,MAAAT,GAAA,EAAA,CAAAH,EAAAO,EAAAM,QANb,MAAAC,GAAAV,GAAA,EAAAC,EAAAS,EAAA,QAAA,KAAAX,GAAAK,EAAAO,QAAAP,EAAAO,SAAA,QAAA,GAAAX,EAAA,MAAAC,IA6DpB/C,EAAAA,gBAAG4C,GACJrD,EAAAmE,MAFDnE,EAAAmE,OAAA,GA5DsBnE,EAAAmE,MAAAhE,eAAAA,EAxD5B,CA6HGiE,OAAOpE,GAAIC","file":"rocketbelt.forms.min.js","sourcesContent":["'use strict';\n((rb, document) => {\n  const aria = rb.aria;\n  const DESCRIBED_BY_ERROR_ID_ATTR = 'data-rb-describedbyerrorid';\n\n  function onClassMutation(mutations) {\n    const mutationsLen = mutations.length;\n\n    for (let k = 0; k < mutationsLen; k++) {\n      const mutation = mutations[k];\n      const el = mutation.target;\n      const message = el.parentNode.querySelector('.validation-message');\n\n      let describedByErrorId = '';\n      let describedByIds = [];\n      let i = -1;\n\n      if (mutation.oldValue !== 'invalid' && mutation.target.classList.contains('invalid')) {\n        // If \"invalid\" was added, do the decoratin'\n        el.setAttribute(aria.invalid, 'true');\n        describedByErrorId = el.getAttribute(DESCRIBED_BY_ERROR_ID_ATTR);\n        describedByIds = el.getAttribute(aria.describedby).split(' ');\n        i = describedByIds.indexOf(describedByErrorId);\n\n        if (message) {\n          message.setAttribute(aria.role, 'alert');\n          message.setAttribute(aria.live, 'polite');\n\n          // If a validation message exists && the related element is newly invalid,\n          // add message id to described-by\n          if (i === -1) {\n            describedByIds.push(describedByErrorId);\n            el.setAttribute(aria.describedby, describedByIds.join(' '));\n          }\n        }\n      } else if (mutation.oldValue === 'invalid' && !el.classList.contains('invalid')) {\n        // If \"invalid\" was removed\n        el.setAttribute(aria.invalid, 'false');\n        describedByErrorId = el.getAttribute(DESCRIBED_BY_ERROR_ID_ATTR);\n        describedByIds = el.getAttribute(aria.describedby).split(' ');\n        i = describedByIds.indexOf(describedByErrorId);\n\n        if (message) {\n          message.removeAttribute('role');\n          message.removeAttribute(aria.live);\n\n          // If a validation message exists && the related element longer invalid,\n          // remove message id from described-by\n          if (i > -1) {\n            describedByIds.splice(i, 1);\n            el.setAttribute(aria.describedby, describedByIds.join(' '));\n          }\n        }\n      }\n    }\n  }\n\n  function decorateInputs() {\n    const formEls = document.querySelectorAll(\n      '.form-group input, .form-group select, .form-group textarea, .form-group fieldset'\n    );\n    const formElsLen = formEls.length;\n\n    for (let i = 0; i < formElsLen; i++) {\n      const el = formEls[i];\n\n      // \"invalid\" will be raised by the checkValidity() call below.\n      // .invalid is added and will be handled by the MutationObserver\n      // created by this function.\n      // https://daverupert.com/2017/11/happier-html5-forms/\n      el.addEventListener('invalid', () => {\n        el.classList.add('invalid');\n      }, false);\n\n      // Set an observer to listen for .invalid.\n      const observer = new MutationObserver(mutations => { onClassMutation(mutations); });\n      observer.observe(el, {\n        subtree: false,\n        attributes: true,\n        attributeOldValue: true,\n        attributeFilter: ['class']\n      });\n\n      const messages = el.parentNode.querySelectorAll('.validation-message, .helper-text');\n      const msgLen = messages.length;\n\n      if (msgLen > 0) {\n        let describedByIds = '';\n\n        if (el.hasAttribute(aria.describedby)) {\n          describedByIds = `${el.getAttribute(aria.describedby)} `;\n        }\n\n        for (let j = 0; j < msgLen; j++) {\n          const thisMsg = messages[j];\n          const id = thisMsg.id ? thisMsg.id : `rb-a11y_${rb.getShortId()}`;\n          describedByIds += `${id} `;\n\n          if (thisMsg.classList.contains('validation-message')) {\n            el.setAttribute(DESCRIBED_BY_ERROR_ID_ATTR, id);\n          }\n\n          // Don't clobber any existing attributes!\n          if (!thisMsg.id) {\n            thisMsg.id = id;\n          }\n        }\n\n        if (!el.hasAttribute(aria.describedby)) {\n          el.setAttribute(aria.describedby, describedByIds.trim());\n        }\n      }\n    }\n\n    const formsAndGroups =\n      document.querySelectorAll('form.validate-on-blur, .form-group.validate-on-blur');\n    for (const el of formsAndGroups) {\n      el.addEventListener('blur', () => {\n        el.checkValidity();\n      });\n    }\n  }\n\n  rb.onDocumentReady(decorateInputs);\n  rb.forms = rb.forms || {};\n  rb.forms.decorateInputs = decorateInputs;\n})(window.rb, document);\n"],"sourceRoot":"../.."}