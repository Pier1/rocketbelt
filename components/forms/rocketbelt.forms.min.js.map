{"version":3,"sources":["components/forms/rocketbelt.forms.min.js"],"names":["rb","document","onClassMutation","mutations","mutationsLen","length","k","mutation","el","target","message","parentNode","querySelector","describedByErrorId","describedByIds","i","oldValue","classList","contains","setAttribute","aria","invalid","getAttribute","DESCRIBED_BY_ERROR_ID_ATTR","describedby","split","indexOf","role","live","push","join","removeAttribute","splice","decorateInputs","formEls","querySelectorAll","formElsLen","formEl","MutationObserver","observe","subtree","attributes","attributeOldValue","attributeFilter","messages","msgLen","hasAttribute","j","thisMsg","id","getShortId","trim","onDocumentReady","forms","window"],"mappings":"CAAA,SAA0BA,EAAIC,GAI5B,SAASC,EAAgBC,GAGvB,IAAK,IAFDC,EAAeD,EAAUE,OAEpBC,EAAI,EAAGA,EAAIF,EAAcE,IAAK,CACrC,IAAIC,EAAWJ,EAAUG,GACrBE,EAAKD,EAASE,OACdC,EAAUF,EAAGG,WAAWC,cAAc,uBAEtCC,EAAqB,GACrBC,KACAC,GAAK,EAEiB,YAAtBR,EAASS,UAA0BT,EAASE,OAAOQ,UAAUC,SAAS,YAExEV,EAAGW,aAAaC,EAAKC,QAAS,QAC9BR,EAAqBL,EAAGc,aAAaC,GAErCR,GADAD,EAAiBN,EAAGc,aAAaF,EAAKI,aAAaC,MAAM,MACtCC,QAAQb,GAEvBH,IACFA,EAAQS,aAAaC,EAAKO,KAAM,SAChCjB,EAAQS,aAAaC,EAAKQ,KAAM,WAIrB,IAAPb,IACFD,EAAee,KAAKhB,GACpBL,EAAGW,aAAaC,EAAKI,YAAaV,EAAegB,KAAK,SAG3B,YAAtBvB,EAASS,UAA2BR,EAAGS,UAAUC,SAAS,aAEnEV,EAAGW,aAAaC,EAAKC,QAAS,SAC9BR,EAAqBL,EAAGc,aAAaC,GAErCR,GADAD,EAAiBN,EAAGc,aAAaF,EAAKI,aAAaC,MAAM,MACtCC,QAAQb,GAEvBH,IACFA,EAAQqB,gBAAgB,QACxBrB,EAAQqB,gBAAgBX,EAAKQ,MAIzBb,GAAK,IACPD,EAAekB,OAAOjB,EAAG,GACzBP,EAAGW,aAAaC,EAAKI,YAAaV,EAAegB,KAAK,UAOhE,SAASG,IAIP,IAAK,IAHDC,EAAUjC,EAASkC,iBAAiB,qFACpCC,EAAaF,EAAQ7B,OAEhBU,EAAI,EAAGA,EAAIqB,EAAYrB,IAAK,CACnC,IAAIsB,EAASH,EAAQnB,GAGN,IAAIuB,iBAAiB,SAAUnC,GAAaD,EAAgBC,KAClEoC,QAAQF,GAAUG,SAAS,EAAOC,YAAY,EAAMC,mBAAmB,EAAMC,iBAAkB,WAExG,IAAIC,EAAWP,EAAO1B,WAAWwB,iBAAiB,qCAC9CU,EAASD,EAASvC,OAEtB,GAAIwC,EAAS,EAAG,CACd,IAAI/B,EAAiB,GAEjBuB,EAAOS,aAAa1B,EAAKI,eAC3BV,EAAiBuB,EAAOf,aAAaF,EAAKI,aAAe,KAG3D,IAAK,IAAIuB,EAAI,EAAGA,EAAIF,EAAQE,IAAK,CAC/B,IAAIC,EAAUJ,EAASG,GACnBE,EAAKD,EAAQC,GAAKD,EAAQC,GAAK,WAAajD,EAAGkD,aACnDpC,GAAkBmC,EAAK,IAEnBD,EAAQ/B,UAAUC,SAAS,uBAC7BmB,EAAOlB,aAAaI,EAA4B0B,GAI7CD,EAAQC,KACXD,EAAQC,GAAKA,GAIZZ,EAAOS,aAAa1B,EAAKI,cAC5Ba,EAAOlB,aAAaC,EAAKI,YAAaV,EAAeqC,UA5F7D,IAAI/B,EAAOpB,EAAGoB,KACVG,EAA6B,6BAiGjCvB,EAAGoD,gBAAgBnB,GACnBjC,EAAGqD,MAAQrD,EAAGqD,UACdrD,EAAGqD,MAAMpB,eAAiBA,EArG5B,CAsGGqB,OAAOtD,GAAIC","file":"rocketbelt.forms.min.js","sourcesContent":["(function rocketbeltForms(rb, document) {\n  var aria = rb.aria;\n  var DESCRIBED_BY_ERROR_ID_ATTR = 'data-rb-describedbyerrorid';\n\n  function onClassMutation(mutations) {\n    var mutationsLen = mutations.length;\n\n    for (var k = 0; k < mutationsLen; k++) {\n      var mutation = mutations[k];\n      var el = mutation.target;\n      var message = el.parentNode.querySelector('.validation-message');\n\n      var describedByErrorId = '';\n      var describedByIds = [];\n      var i = -1;\n\n      if (mutation.oldValue !== 'invalid' && mutation.target.classList.contains('invalid')) {\n        // If \"invalid\" was added, do the decoratin'\n        el.setAttribute(aria.invalid, 'true');\n        describedByErrorId = el.getAttribute(DESCRIBED_BY_ERROR_ID_ATTR);\n        describedByIds = el.getAttribute(aria.describedby).split(' ');\n        i = describedByIds.indexOf(describedByErrorId);\n\n        if (message) {\n          message.setAttribute(aria.role, 'alert');\n          message.setAttribute(aria.live, 'polite');\n\n          // If a validation message exists && the related element is newly invalid,\n          // add message id to described-by\n          if (i === -1) {\n            describedByIds.push(describedByErrorId);\n            el.setAttribute(aria.describedby, describedByIds.join(' '));\n          }\n        }\n      } else if (mutation.oldValue === 'invalid' && !el.classList.contains('invalid')) {\n        // If \"invalid\" was removed\n        el.setAttribute(aria.invalid, 'false');\n        describedByErrorId = el.getAttribute(DESCRIBED_BY_ERROR_ID_ATTR);\n        describedByIds = el.getAttribute(aria.describedby).split(' ');\n        i = describedByIds.indexOf(describedByErrorId);\n\n        if (message) {\n          message.removeAttribute('role');\n          message.removeAttribute(aria.live);\n\n          // If a validation message exists && the related element longer invalid,\n          // remove message id from described-by\n          if (i > -1) {\n            describedByIds.splice(i, 1);\n            el.setAttribute(aria.describedby, describedByIds.join(' '));\n          }\n        }\n      }\n    }\n  }\n\n  function decorateInputs() {\n    var formEls = document.querySelectorAll('.form-group input, .form-group select, .form-group textarea, .form-group fieldset');\n    var formElsLen = formEls.length;\n\n    for (var i = 0; i < formElsLen; i++) {\n      var formEl = formEls[i];\n\n      // Set an observer to listen for .invalid.\n      var observer = new MutationObserver(function (mutations) { onClassMutation(mutations); });\n      observer.observe(formEl, { subtree: false, attributes: true, attributeOldValue: true, attributeFilter: ['class'] });\n\n      var messages = formEl.parentNode.querySelectorAll('.validation-message, .helper-text');\n      var msgLen = messages.length;\n\n      if (msgLen > 0) {\n        var describedByIds = '';\n\n        if (formEl.hasAttribute(aria.describedby)) {\n          describedByIds = formEl.getAttribute(aria.describedby) + ' ';\n        }\n\n        for (var j = 0; j < msgLen; j++) {\n          var thisMsg = messages[j];\n          var id = thisMsg.id ? thisMsg.id : 'rb-a11y_' + rb.getShortId();\n          describedByIds += id + ' ';\n\n          if (thisMsg.classList.contains('validation-message')) {\n            formEl.setAttribute(DESCRIBED_BY_ERROR_ID_ATTR, id);\n          }\n\n          // Don't clobber any existing attributes!\n          if (!thisMsg.id) {\n            thisMsg.id = id;\n          }\n        }\n\n        if (!formEl.hasAttribute(aria.describedby)) {\n          formEl.setAttribute(aria.describedby, describedByIds.trim());\n        }\n      }\n    }\n  }\n\n  rb.onDocumentReady(decorateInputs);\n  rb.forms = rb.forms || {};\n  rb.forms.decorateInputs = decorateInputs;\n})(window.rb, document);\n"],"sourceRoot":"../.."}