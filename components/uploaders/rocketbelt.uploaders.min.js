"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}!function(c,u,f){var r="uploader-dragged-on",h="uploader-max-files";function i(e){var t=void 0;return e.classList&&(t=e.classList.contains("uploader")?e:e.closest(".uploader")),t}function p(e){i(e.target)&&f("#"+i(e.target).id+' input[type="file"]').click()}function d(e){var t;(t=i(e.target))&&t.classList&&(t.classList&&t.classList.add("uploader-expanded"),t.removeAttribute(c.aria.role),t.removeAttribute("tabindex"),t.removeEventListener("click",p),t.removeEventListener("click",d))}function s(t){return c.uploaders.instances.filter(function(e){return e.config.id===t})[0]}function o(e){var t=s(i(e.target).id).config;t.isMobile&&d(e),c.uploaders.handleFiles(this.files,t.id)}function l(e){e.preventDefault(),e.stopPropagation()}function v(e){var t=f(e.target),a=t.hasClass(r)?t:t.closest(".uploader");a.hasClass(r)||(a.find(".scrim, .scrim_icon").css("z-index","1"),a.addClass(r))}function m(e){var t=f(e.target),a=t.hasClass(r)?t:t.closest(".uploader");a.hasClass(r)&&(a.removeClass(r),a.find(".scrim, .scrim_icon").css("z-index","-1"))}function g(e){var t=i(e.target);if(0<c.uploaders.numCanAdd(t.id)){var a=e.dataTransfer.files;c.uploaders.handleFiles(a,t.id)}}function b(e,s,o,t,a){var r=u.createElement("img");r.src=e?t.result:a.file,r.id="rb_"+c.getShortId(),r.classList.add("uploader_thumb");var i={id:r.id,file:e?c.dataURItoBlob(t.result):a.file,size:e?t.size:a.size};s.files.push(i),o.dispatchEvent(new CustomEvent("rb.uploaders.fileAdded",{detail:i}));var n=u.createElement("button");n.dataset.targetId=r.id,n.classList.add("uploader_thumbs_remove-button"),n.innerHTML="&times;",n.setAttribute(c.aria.label,"Remove this image"),c.once(n,"click",function(e){var t=e.target.dataset.targetId,a=u.querySelector("#"+t),r=e.target.closest(".uploader"),i=u.querySelector(s.config.selector);if(a.parentNode.removeChild(a),e.target.parentNode.removeChild(e.target),f(i).find('input[type="file"]').val(""),r&&0===r.querySelectorAll(".uploader_thumb").length&&(r.classList.remove("uploader-has-thumbs"),s.config.isMobile&&(r.classList.remove("uploader-expanded"),i.addEventListener("click",p))),s.files=s.files.filter(function(e){return e.id!==t}),0<c.uploaders.numCanAdd(o.id)){var n=f("#"+o.id);f("#"+o.id+" .uploader_file-input, #"+o.id+" .uploader_file-label").removeAttr("disabled"),n.removeClass(h)}var d={removedId:t};u.getElementById(o.id).dispatchEvent(new CustomEvent("rb.uploaders.fileRemoved",{detail:d}))}),u.querySelector("#"+o.id+" .uploader_thumbs").appendChild(r),u.querySelector("#"+r.id).insertAdjacentElement("afterend",n);var d=u.querySelector("#"+o.id);if(d&&d.classList.add("uploader-has-thumbs"),!c.uploaders.numCanAdd(o.id)){var l=f("#"+o.id);f("#"+o.id+" .uploader_file-input, #"+o.id+" .uploader_file-label").attr("disabled",""),l.addClass(h)}}["dragenter","dragover","dragleave","drop"].forEach(function(e){u.body.addEventListener(e,l)}),c.uploaders=c.uploaders||{},c.uploaders.addUploader=function(e){var t=void 0;if(e&&e.selector){if((t=u.querySelector(e.selector)).id=t.id||"rb_"+c.getShortId(),e.id=t.id,e.isMobile=e.isMobile||t&&t.classList&&t.classList.contains("uploader-mobile")||0<u.querySelectorAll(".mobile .uploader, .tablet .uploader").length,t&&t.classList&&(e.isMobile&&(t.classList.add("uploader-mobile"),t.addEventListener("click",p)),t.classList.contains("uploader-expanded")||(t.setAttribute(c.aria.role,"button"),t.setAttribute("tabindex",0))),!e.isMobile){t.addEventListener("click",d),["dragenter","dragover","dragleave","drop"].forEach(function(e){t.addEventListener(e,l)}),["dragenter","dragover"].forEach(function(e){t.addEventListener(e,v)}),["dragleave","drop"].forEach(function(e){t.addEventListener(e,m)}),t.addEventListener("drop",g);var a=u.createElement("div");a.classList.add("scrim"),t.insertAdjacentElement("afterbegin",a);var r=u.createElement("div");r.classList.add("scrim_icon"),a.insertAdjacentElement("afterend",r)}c.uploaders.instances=c.uploaders.instances||[],c.uploaders.instances.push({config:e,files:[]}),f(t).find(".uploader_file-label").keydown(function(e){13!==e.which&&32!==e.which||f(e.target).click()});var i=f(t).find('input[type="file"]'),n=i[0].id||"rb_"+c.getShortId();i.attr("id",n),f(t).find(".uploader_file-label").attr("for",n).attr("aria-role","button").attr("tabindex",0),i.change(o)}return t.id},c.uploaders.getInstanceForId=s,c.uploaders.numCanAdd=function(e){var t=s(e),a=t.files?t.files.length:0;return(t.config.maxFiles||Number.POSITIVE_INFINITY)-a},c.uploaders.handleFiles=function(e,d){var t=c.uploaders.numCanAdd(d);[].concat(_toConsumableArray(e)).slice(0,t).forEach(function(e){var t,a,r,i,n;t=e,r=s(a=d),i=u.getElementById(a),(n=new FileReader).size=t.size,i.dispatchEvent(new CustomEvent("rb.uploaders.addingFile")),n.readAsDataURL(t),n.onloadend=function(){var t,e=r.config.filesAsBinary?c.dataURItoBlob(n.result):n.result;r.config.filesAsBinary?b(!0,r,i,n):(t=e,new Promise(function(o,e){var l=new Image;l.src=t,l.onload=function(){var s=1;jQuery.ajax({url:"https://cdn.jsdelivr.net/npm/exif-js",dataType:"script",cache:!0}).done(function(){EXIF.getData(l,function(){s=EXIF.getTag(this,"Orientation");var e=function(e){var t=e.width,a=e.height,r=void 0,i=void 0;if(t<=1500&&a<=1500)return{width:t,height:a};if(t<a){if(!(1500<a))return{width:t,height:a};i=1500,r=Math.floor(t/a*i)}else{if(!(1500<t))return{width:t,height:a};r=1500,i=Math.floor(a/t*r)}return{width:r,height:i}}({width:l.width,height:l.height}),t=e.width,a=e.height,r=u.createElement("canvas");4<s&&s<9?(r.width=a,r.height=t):(r.width=t,r.height=a);var i=r.getContext("2d");switch(s){case 2:i.transform(-1,0,0,1,t,0);break;case 3:i.transform(-1,0,0,-1,t,a);break;case 4:i.transform(1,0,0,-1,0,a);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,a,0);break;case 7:i.transform(0,-1,-1,0,a,t);break;case 8:i.transform(0,-1,1,0,0,t)}i.drawImage(l,0,0,t,a);var n=r.toDataURL("image/png",.9),d=Math.ceil(.75*n.split(",")[1].length);o({file:n,size:d})})})},l.onerror=e})).then(function(e){b(!1,r,i,n,e)})}})}}(window.rb,document,jQuery);
//# sourceMappingURL=rocketbelt.uploaders.min.js.map
