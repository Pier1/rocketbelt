"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,r=Array(e.length);a<e.length;a++)r[a]=e[a];return r}return Array.from(e)}!function(i,o,l){var r="uploader-dragged-on",n="uploader-max-files";function d(){l("#"+i.uploaders.config.id+' input[type="file"]').click()}function s(e){var a,r=void 0;e.target.classList&&(r=e.target.classList.contains("uploader")?e.target:e.target.closest(".uploader")),(a=r)&&a.classList&&(a.classList&&a.classList.add("uploader-expanded"),a.removeAttribute(i.aria.role),a.removeAttribute("tabindex"),a.removeEventListener("click",d),a.removeEventListener("click",s))}function u(e){i.uploaders.config.isMobile&&s(e),i.uploaders.handleFiles(this.files,i.uploaders.config)}function c(e){e.preventDefault(),e.stopPropagation()}function p(e){var a=l(e.target).hasClass(r)?l(e.target):l(e.target).closest(".uploader");a.hasClass(r)||(a.find(".scrim, .scrim_icon").css("z-index","1"),a.addClass(r))}function f(e){var a=l(e.target).hasClass(r)?l(e.target):l(e.target).closest(".uploader");a.hasClass(r)&&(a.removeClass(r),a.find(".scrim, .scrim_icon").css("z-index","-1"))}function v(e){if(0<i.uploaders.numCanAdd()){var a=e.dataTransfer.files;i.uploaders.handleFiles(a,i.uploaders.config)}}["dragenter","dragover","dragleave","drop"].forEach(function(e){o.body.addEventListener(e,c)}),i.uploaders=i.uploaders||{},i.uploaders.addUploader=function(e){if(e&&e.selector){var a=o.querySelector(e.selector);if(a.id=a.id||"rb_"+i.getShortId(),e.id=a.id,e.isMobile=e.isMobile||a&&a.classList&&a.classList.contains("uploader-mobile")||0<o.querySelectorAll(".mobile .uploader, .tablet .uploader").length,a&&a.classList&&(e.isMobile&&(a.classList.add("uploader-mobile"),a.addEventListener("click",d)),a.classList.contains("uploader-expanded")||(a.setAttribute(i.aria.role,"button"),a.setAttribute("tabindex",0))),!e.isMobile){a.addEventListener("click",s),["dragenter","dragover","dragleave","drop"].forEach(function(e){a.addEventListener(e,c)}),["dragenter","dragover"].forEach(function(e){a.addEventListener(e,p)}),["dragleave","drop"].forEach(function(e){a.addEventListener(e,f)}),a.addEventListener("drop",v);var r=o.createElement("div");r.classList.add("scrim"),a.insertAdjacentElement("afterbegin",r);var t=o.createElement("div");t.classList.add("scrim_icon"),r.insertAdjacentElement("afterend",t)}i.uploaders.config=e,l(a).find(".uploader_file-label").keydown(function(e){13!==e.which&&32!==e.which||l(e.target).click()}),l(a).find('input[type="file"]').change(u)}},i.uploaders.numCanAdd=function(){var e=i.uploaders.files?i.uploaders.files.length:0;return(i.uploaders.config.maxFiles||Number.POSITIVE_INFINITY)-e};var t=[],g=o.querySelector(".uploader progress");function m(e,a){t[e]=a;var r=t.reduce(function(e,a){return e+a},0)/t.length;g.value=r}function h(e){i.uploaders.files=i.uploaders.files||[];var s=new FileReader;s.size=e.size,o.getElementById(i.uploaders.config.id).dispatchEvent(new CustomEvent("rb.uploaders.addingFile")),s.readAsDataURL(e),s.onloadend=function(){var e=o.createElement("img");e.src=s.result,e.id="rb_"+i.getShortId(),e.classList.add("uploader_thumb");var a={id:e.id,file:s.result,size:s.size};i.uploaders.files.push(a),o.getElementById(i.uploaders.config.id).dispatchEvent(new CustomEvent("rb.uploaders.fileAdded",{detail:a}));var r=o.createElement("button");r.dataset.targetId=e.id,r.classList.add("uploader_thumbs_remove-button"),r.innerHTML="&times;",r.setAttribute(i.aria.label,"Remove this image"),i.once(r,"click",function(e){var a=e.target.dataset.targetId,r=o.querySelector("#"+a),t=e.target.closest(".uploader");if(r.parentNode.removeChild(r),e.target.parentNode.removeChild(e.target),t&&0===t.querySelectorAll(".uploader_thumb").length&&t.classList.remove("uploader-has-thumbs"),i.uploaders.files=i.uploaders.files.filter(function(e){return e.id!==a}),0<i.uploaders.numCanAdd()){var d=l("#"+i.uploaders.config.id);l(".uploader #uploader_file-input, .uploader .uploader_file-label").removeAttr("disabled"),d.removeClass(n)}var s={removedId:a};o.getElementById(i.uploaders.config.id).dispatchEvent(new CustomEvent("rb.uploaders.fileRemoved",{detail:s}))}),o.querySelector(".uploader_thumbs").appendChild(e),o.querySelector("#"+e.id).insertAdjacentElement("afterend",r);var t=o.querySelector("#"+i.uploaders.config.id);if(t&&t.classList.add("uploader-has-thumbs"),!i.uploaders.numCanAdd()){var d=l("#"+i.uploaders.config.id);l(".uploader #uploader_file-input, .uploader .uploader_file-label").attr("disabled",""),d.addClass(n)}}}function b(e,a){var r=new FormData,t=new XMLHttpRequest;r=i.uploaders.config.prepFormData(r),i.uploaders.config.prepXhr&&(t=i.uploaders.config.prepXhr(t)),t.open("POST",i.uploaders.config.postUri,!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.upload.addEventListener("progress",function(e){m(a,100*e.loaded/e.total||100)}),t.addEventListener("readystatechange",function(e){4===t.readyState&&200===t.status?m(a,100):4===t.readyState&&t.status}),t.send(r)}i.uploaders.handleFiles=function(e){var a=i.uploaders.numCanAdd(),r=[].concat(_toConsumableArray(e)).slice(0,a);!function(e){g.value=0,t=[];for(var a=e;0<a;a--)t.push(0)}(r.length),i.uploaders.config.autoUpload&&r.forEach(b),r.forEach(h)}}(window.rb,document,jQuery);
//# sourceMappingURL=rocketbelt.uploaders.min.js.map
