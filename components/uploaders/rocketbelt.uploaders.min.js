"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(c,u,f){var a="uploader-dragged-on",h="uploader-max-files";function i(e){var t=void 0;return e.classList&&(t=e.classList.contains("uploader")?e:e.closest(".uploader")),t}function p(e){i(e.target)&&f("#"+i(e.target).id+' input[type="file"]').click()}function d(e){!function(e){e&&e.classList&&(e.classList&&e.classList.add("uploader-expanded"),e.removeAttribute(c.aria.role),e.removeAttribute("tabindex"),e.removeEventListener("click",p),e.removeEventListener("click",d))}(i(e.target))}function n(t){return c.uploaders.instances.filter(function(e){return e.config.id===t})[0]}function s(e){var t=n(i(e.target).id).config;t.isMobile&&d(e),c.uploaders.handleFiles(this.files,t.id)}function o(e){e.preventDefault(),e.stopPropagation()}function l(e){var t=f(e.target),r=t.hasClass(a)?t:t.closest(".uploader");r.hasClass(a)||(r.find(".scrim, .scrim_icon").css("z-index","1"),r.addClass(a))}function v(e){var t=f(e.target),r=t.hasClass(a)?t:t.closest(".uploader");r.hasClass(a)&&(r.removeClass(a),r.find(".scrim, .scrim_icon").css("z-index","-1"))}function m(e){var t=i(e.target);if(0<c.uploaders.numCanAdd(t.id)){var r=e.dataTransfer.files;c.uploaders.handleFiles(r,t.id)}}function g(e,s,o,t,r){var a=u.createElement("img");a.src=e?t.result:r.file,a.id="rb_"+c.getShortId(),a.classList.add("uploader_thumb");var i={id:a.id,file:e?c.dataURItoBlob(t.result):r.file,size:e?t.size:r.size};s.files.push(i),o.dispatchEvent(new CustomEvent("rb.uploaders.fileAdded",{detail:i}));var n=u.createElement("button");n.dataset.targetId=a.id,n.classList.add("uploader_thumbs_remove-button"),n.innerHTML="&times;",n.setAttribute(c.aria.label,"Remove this image"),c.once(n,"click",function(e){var t=e.target.dataset.targetId,r=u.querySelector("#"+t),a=e.target.closest(".uploader"),i=u.querySelector(s.config.selector);if(r.parentNode.removeChild(r),e.target.parentNode.removeChild(e.target),f(i).find('input[type="file"]').val(""),a&&0===a.querySelectorAll(".uploader_thumb").length&&(a.classList.remove("uploader-has-thumbs"),s.config.isMobile&&(a.classList.remove("uploader-expanded"),i.addEventListener("click",p))),s.files=s.files.filter(function(e){return e.id!==t}),0<c.uploaders.numCanAdd(o.id)){var n=f("#"+o.id);f("#"+o.id+" .uploader_file-input, #"+o.id+" .uploader_file-label").removeAttr("disabled"),n.removeClass(h)}var d={removedId:t};u.getElementById(o.id).dispatchEvent(new CustomEvent("rb.uploaders.fileRemoved",{detail:d}))}),u.querySelector("#"+o.id+" .uploader_thumbs").appendChild(a),u.querySelector("#"+a.id).insertAdjacentElement("afterend",n);var d=u.querySelector("#"+o.id);if(d&&d.classList.add("uploader-has-thumbs"),!c.uploaders.numCanAdd(o.id)){var l=f("#"+o.id);f("#"+o.id+" .uploader_file-input, #"+o.id+" .uploader_file-label").attr("disabled",""),l.addClass(h)}}["dragenter","dragover","dragleave","drop"].forEach(function(e){u.body.addEventListener(e,o)}),c.uploaders=c.uploaders||{},c.uploaders.addUploader=function(e){var t=void 0;if(e&&e.selector){if((t=u.querySelector(e.selector)).id=t.id||"rb_"+c.getShortId(),e.id=t.id,e.isMobile=e.isMobile||t&&t.classList&&t.classList.contains("uploader-mobile")||0<u.querySelectorAll(".mobile .uploader, .tablet .uploader").length,t&&t.classList&&(e.isMobile&&(t.classList.add("uploader-mobile"),t.addEventListener("click",p)),t.classList.contains("uploader-expanded")||(t.setAttribute(c.aria.role,"button"),t.setAttribute("tabindex",0))),!e.isMobile){t.addEventListener("click",d),["dragenter","dragover","dragleave","drop"].forEach(function(e){t.addEventListener(e,o)}),["dragenter","dragover"].forEach(function(e){t.addEventListener(e,l)}),["dragleave","drop"].forEach(function(e){t.addEventListener(e,v)}),t.addEventListener("drop",m);var r=u.createElement("div");r.classList.add("scrim"),t.insertAdjacentElement("afterbegin",r);var a=u.createElement("div");a.classList.add("scrim_icon"),r.insertAdjacentElement("afterend",a)}c.uploaders.instances=c.uploaders.instances||[],c.uploaders.instances.push({config:e,files:[]}),f(t).find(".uploader_file-label").keydown(function(e){13!==e.which&&32!==e.which||f(e.target).click()});var i=f(t).find('input[type="file"]'),n=i[0].id||"rb_"+c.getShortId();i.attr("id",n),f(t).find(".uploader_file-label").attr("for",n).attr("aria-role","button").attr("tabindex",0),i.change(s)}return t.id},c.uploaders.getInstanceForId=n,c.uploaders.numCanAdd=function(e){var t=n(e),r=t.files?t.files.length:0;return(t.config.maxFiles||Number.POSITIVE_INFINITY)-r},c.uploaders.handleFiles=function(e,t){var r=c.uploaders.numCanAdd(t);[].concat(_toConsumableArray(e)).slice(0,r).forEach(function(e){!function(e,t){var r=n(t),a=u.getElementById(t),i=new FileReader;i.size=e.size,a.dispatchEvent(new CustomEvent("rb.uploaders.addingFile")),i.readAsDataURL(e),i.onloadend=function(){var e=r.config.filesAsBinary?c.dataURItoBlob(i.result):i.result;r.config.filesAsBinary?g(!0,r,a,i):function(t){return new Promise(function(o,e){var l=new Image;l.src=t,l.onload=function(){var s=1;jQuery.ajax({url:"https://cdn.jsdelivr.net/npm/exif-js",dataType:"script",cache:!0}).done(function(){EXIF.getData(l,function(){s=EXIF.getTag(this,"Orientation");var e=function(e){var t=e.width,r=e.height,a=void 0,i=void 0;if(t<=1500&&r<=1500)return{width:t,height:r};if(t<r){if(!(1500<r))return{width:t,height:r};i=1500,a=Math.floor(t/r*i)}else{if(!(1500<t))return{width:t,height:r};a=1500,i=Math.floor(r/t*a)}return{width:a,height:i}}({width:l.width,height:l.height}),t=e.width,r=e.height,a=u.createElement("canvas");4<s&&s<9?(a.width=r,a.height=t):(a.width=t,a.height=r);var i=a.getContext("2d");switch(s){case 2:i.transform(-1,0,0,1,t,0);break;case 3:i.transform(-1,0,0,-1,t,r);break;case 4:i.transform(1,0,0,-1,0,r);break;case 5:i.transform(0,1,1,0,0,0);break;case 6:i.transform(0,1,-1,0,r,0);break;case 7:i.transform(0,-1,-1,0,r,t);break;case 8:i.transform(0,-1,1,0,0,t)}i.drawImage(l,0,0,t,r);var n=a.toDataURL("image/png",.9),d=Math.ceil(.75*n.split(",")[1].length);o({file:n,size:d})})})},l.onerror=e})}(e).then(function(e){g(!1,r,a,i,e)})}}(e,t)})}}(window.rb,document,jQuery);
//# sourceMappingURL=rocketbelt.uploaders.min.js.map
