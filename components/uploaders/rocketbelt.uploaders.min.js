"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var a=0,r=Array(e.length);a<e.length;a++)r[a]=e[a];return r}return Array.from(e)}!function(n,s,i){var r="uploader-dragged-on",l="uploader-max-files";function d(e){var a,r=e.target.classList.contains("uploader")?e.target:e.target.closest(".uploader");(a=r).classList.add("uploader-expanded"),a.removeAttribute(n.aria.role),a.removeAttribute("tabindex"),a.removeEventListener("click",d)}function o(e){n.uploaders.handleFiles(this.files,n.uploaders.config)}function u(e){e.preventDefault(),e.stopPropagation()}function c(e){var a=i(e.target).hasClass(r)?i(e.target):i(e.target).closest(".uploader");a.hasClass(r)||(a.find(".scrim, .scrim_icon").css("z-index","1"),a.addClass(r))}function p(e){var a=i(e.target).hasClass(r)?i(e.target):i(e.target).closest(".uploader");a.hasClass(r)&&(a.removeClass(r),a.find(".scrim, .scrim_icon").css("z-index","-1"))}function f(e){if(0<n.uploaders.numCanAdd()){var a=e.dataTransfer.files;n.uploaders.handleFiles(a,n.uploaders.config)}}["dragenter","dragover","dragleave","drop"].forEach(function(e){s.body.addEventListener(e,u)}),n.uploaders=n.uploaders||{},n.uploaders.addUploader=function(e){if(e&&e.selector){var a=s.querySelector(e.selector);if(a.id=a.id||"rb_"+n.getShortId(),e.id=a.id,a.classList.contains("uploader-expanded")||(a.setAttribute(n.aria.role,"button"),a.setAttribute("tabindex",0)),!a.classList.contains("uploader-mobile")){a.addEventListener("click",d),["dragenter","dragover","dragleave","drop"].forEach(function(e){a.addEventListener(e,u)}),["dragenter","dragover"].forEach(function(e){a.addEventListener(e,c)}),["dragleave","drop"].forEach(function(e){a.addEventListener(e,p)}),a.addEventListener("drop",f);var r=s.createElement("div");r.classList.add("scrim"),a.insertAdjacentElement("afterbegin",r);var t=s.createElement("div");t.classList.add("scrim_icon"),r.insertAdjacentElement("afterend",t)}n.uploaders.config=e,i(a).find(".uploader_file-label").keydown(function(e){13!==e.which&&32!==e.which||i(e.target).click()}),i(a).find('input[type="file"]').change(o)}},n.uploaders.numCanAdd=function(){var e=n.uploaders.files?n.uploaders.files.length:0;return(n.uploaders.config.maxFiles||Number.POSITIVE_INFINITY)-e};var t=[],g=s.querySelector(".uploader progress");function v(e,a){t[e]=a;var r=t.reduce(function(e,a){return e+a},0)/t.length;g.value=r}function m(e){n.uploaders.files=n.uploaders.files||[];var d=new FileReader;d.size=e.size,s.getElementById(n.uploaders.config.id).dispatchEvent(new CustomEvent("rb.uploaders.addingFile")),d.readAsDataURL(e),d.onloadend=function(){var e=s.createElement("img");e.src=d.result,e.id="rb_"+n.getShortId(),e.classList.add("uploader_thumb");var a={id:e.id,file:d.result,size:d.size};n.uploaders.files.push(a),s.getElementById(n.uploaders.config.id).dispatchEvent(new CustomEvent("rb.uploaders.fileAdded",{detail:a}));var r=s.createElement("button");if(r.dataset.targetId=e.id,r.classList.add("uploader_thumbs_remove-button"),r.innerHTML="&times;",r.setAttribute(n.aria.label,"Remove this image"),n.once(r,"click",function(e){var a=e.target.dataset.targetId,r=s.querySelector("#"+a),t=e.target.closest(".uploader");if(r.parentNode.removeChild(r),e.target.parentNode.removeChild(e.target),0===t.querySelectorAll(".uploader_thumb").length&&t.classList.remove("uploader-has-thumbs"),n.uploaders.files=n.uploaders.files.filter(function(e){return e.id!==a}),0<n.uploaders.numCanAdd()){var d=i("#"+n.uploaders.config.id);i(".uploader #uploader_file-input, .uploader .uploader_file-label").removeAttr("disabled"),d.removeClass(l)}var o={removedId:a};s.getElementById(n.uploaders.config.id).dispatchEvent(new CustomEvent("rb.uploaders.fileRemoved",{detail:o}))}),s.querySelector(".uploader_thumbs").appendChild(e),s.querySelector("#"+e.id).insertAdjacentElement("afterend",r),s.querySelector("#"+n.uploaders.config.id).classList.add("uploader-has-thumbs"),!n.uploaders.numCanAdd()){var t=i("#"+n.uploaders.config.id);i(".uploader #uploader_file-input, .uploader .uploader_file-label").attr("disabled",""),t.addClass(l)}}}function h(e,a){var r=new FormData,t=new XMLHttpRequest;r=n.uploaders.config.prepFormData(r),n.uploaders.config.prepXhr&&(t=n.uploaders.config.prepXhr(t)),t.open("POST",n.uploaders.config.postUri,!0),t.setRequestHeader("X-Requested-With","XMLHttpRequest"),t.upload.addEventListener("progress",function(e){v(a,100*e.loaded/e.total||100)}),t.addEventListener("readystatechange",function(e){4===t.readyState&&200===t.status?v(a,100):4===t.readyState&&t.status}),t.send(r)}n.uploaders.handleFiles=function(e){var a=n.uploaders.numCanAdd(),r=[].concat(_toConsumableArray(e)).slice(0,a);!function(e){g.value=0,t=[];for(var a=e;0<a;a--)t.push(0)}(r.length),n.uploaders.config.autoUpload&&r.forEach(h),r.forEach(m)}}(window.rb,document,jQuery);
//# sourceMappingURL=rocketbelt.uploaders.min.js.map
